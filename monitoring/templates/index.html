<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè¶ Transaction Monitoring Dashboard</title>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
        .container { max-width: 1400px; margin: 0 auto; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .stat-number { font-size: 2em; font-weight: bold; color: #2c3e50; }
        .stat-label { color: #7f8c8d; font-size: 0.9em; }
        .success { color: #27ae60; }
        .blocked { color: #e74c3c; }
        .pending { color: #f39c12; }
        table { width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ecf0f1; }
        th { background-color: #3498db; color: white; }
        .section { margin-bottom: 30px; }
        .section h2 { color: #2c3e50; border-bottom: 3px solid #3498db; padding-bottom: 10px; }
        .refresh-btn { background: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-bottom: 15px; }
        .refresh-btn:hover { background: #2980b9; }
        .status-badge { padding: 4px 8px; border-radius: 4px; color: white; font-size: 0.8em; }
        .status-1 { background-color: #27ae60; }
        .status-2 { background-color: #e74c3c; }
        .status-0 { background-color: #f39c12; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè¶ Transaction Monitoring Dashboard</h1>
        
        <!-- Statistics Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="total-count">0</div>
                <div class="stat-label">Total Transactions</div>
            </div>
            <div class="stat-card">
                <div class="stat-number success" id="success-count">0</div>
                <div class="stat-label">Successful</div>
            </div>
            <div class="stat-card">
                <div class="stat-number blocked" id="blocked-count">0</div>
                <div class="stat-label">Blocked</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="processing-rate">0</div>
                <div class="stat-label">Transactions/min</div>
            </div>
        </div>

        <!-- Recent Transactions -->
        <div class="section">
            <h2>üìã Recent Transactions</h2>
            <button class="refresh-btn" onclick="loadRecentTransactions()">üîÑ Refresh</button>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>From</th>
                        <th>To</th>
                        <th>Amount</th>
                        <th>Date</th>
                        <th>Status</th>
                        <th>Daily Total</th>
                        <th>Reason</th>
                        <th>Time</th>
                    </tr>
                </thead>
                <tbody id="recent-transactions">
                </tbody>
            </table>
        </div>

        <!-- Blocked Transactions -->
        <div class="section">
            <h2>üö´ Recent Blocked Transactions</h2>
            <button class="refresh-btn" onclick="loadBlockedTransactions()">üîÑ Refresh</button>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>From</th>
                        <th>To</th>
                        <th>Amount</th>
                        <th>Daily Total</th>
                        <th>Reason</th>
                        <th>Time</th>
                    </tr>
                </thead>
                <tbody id="blocked-transactions">
                </tbody>
            </table>
        </div>

        <!-- Daily Summary -->
        <div class="section">
            <h2>üìä Daily Summary by User</h2>
            <button class="refresh-btn" onclick="loadDailySummary()">üîÑ Refresh</button>
            <table>
                <thead>
                    <tr>
                        <th>User</th>
                        <th>Date</th>
                        <th>Total Transactions</th>
                        <th>Successful Amount</th>
                        <th>Blocked Count</th>
                        <th>Last Update</th>
                    </tr>
                </thead>
                <tbody id="daily-summary">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        async function loadStats() {
            try {
                const response = await axios.get('/api/stats');
                const stats = response.data;
                
                document.getElementById('total-count').textContent = stats.total_count || 0;
                document.getElementById('success-count').textContent = stats.success_count || 0;
                document.getElementById('blocked-count').textContent = stats.blocked_count || 0;
                document.getElementById('processing-rate').textContent = stats.processing_rate || 0;
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        async function loadRecentTransactions() {
            try {
                const response = await axios.get('/api/recent-transactions');
                const tbody = document.getElementById('recent-transactions');
                tbody.innerHTML = '';
                
                response.data.slice(0, 20).forEach(txn => {
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${txn.id || 'N/A'}</td>
                        <td>${txn.from_name}</td>
                        <td>${txn.to_name}</td>
                        <td>$${txn.money}</td>
                        <td>${txn.date_str}</td>
                        <td><span class="status-badge status-${txn.status}">${txn.status_text}</span></td>
                        <td>$${txn.daily_total}</td>
                        <td>${txn.reason}</td>
                        <td>${new Date(txn.timestamp * 1000).toLocaleString()}</td>
                    `;
                });
            } catch (error) {
                console.error('Error loading recent transactions:', error);
            }
        }

        async function loadBlockedTransactions() {
            try {
                const response = await axios.get('/api/blocked-transactions');
                const tbody = document.getElementById('blocked-transactions');
                tbody.innerHTML = '';
                
                response.data.forEach(txn => {
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${txn.id || 'N/A'}</td>
                        <td>${txn.from_name}</td>
                        <td>${txn.to_name}</td>
                        <td>$${txn.money}</td>
                        <td>$${txn.daily_total}</td>
                        <td>${txn.reason}</td>
                        <td>${new Date(txn.timestamp * 1000).toLocaleString()}</td>
                    `;
                });
            } catch (error) {
                console.error('Error loading blocked transactions:', error);
            }
        }

        async function loadDailySummary() {
            try {
                const response = await axios.get('/api/daily-summary');
                const tbody = document.getElementById('daily-summary');
                tbody.innerHTML = '';
                
                response.data.forEach(summary => {
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${summary.from_name}</td>
                        <td>${summary.date}</td>
                        <td>${summary.transaction_count}</td>
                        <td>$${summary.total_successful.toFixed(2)}</td>
                        <td>${summary.blocked_count}</td>
                        <td>${new Date(summary.last_update * 1000).toLocaleString()}</td>
                    `;
                });
            } catch (error) {
                console.error('Error loading daily summary:', error);
            }
        }

        // Load all data initially
        loadStats();
        loadRecentTransactions();
        loadBlockedTransactions();
        loadDailySummary();

        // Auto refresh every 5 seconds
        setInterval(() => {
            loadStats();
            loadRecentTransactions();
        }, 5000);

        // Auto refresh blocked and daily summary every 30 seconds
        setInterval(() => {
            loadBlockedTransactions();
            loadDailySummary();
        }, 30000);
    </script>
</body>
</html>